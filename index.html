<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>じゃがバター予約システム</title>
<style>
body { font-family: sans-serif; text-align: center; padding-top: 30px; }
#count { font-size: 28px; margin: 10px 0; }
input { padding: 5px; font-size: 16px; width: 60px; text-align: center; }
button { padding: 10px 15px; margin: 5px; font-size: 16px; }
</style>
</head>
<body>
<h1>じゃがバター予約</h1>
<div>
  <label>受け取り人数:</label>
  <input type="number" id="people" min="1" value="1">
  <button onclick="reserve()">予約する</button>
</div>

<div id="result"></div>
<div id="count">読み込み中...</div>

<script>
const GAS_URL = "https://script.google.com/macros/library/d/1kle1Vx1AAMIwnTM0NJjMGNCQbAJkk4PRLXOGtgARvnU1-pjT3gq49MQV/1";

async function loadCount() {
  const res = await fetch(GAS_URL);
  const data = await res.json();
  document.getElementById("count").innerText =
    `現在の待ち人数: ${data.count}人（目安待ち時間: ${Math.ceil(data.count / 19 * 15)}分）`;
}

async function reserve() {
  const people = parseInt(document.getElementById("people").value);
  if (people < 1) {
    alert("1人以上を入力してください");
    return;
  }
  const res = await fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({ action: "reserve", people: people })
  });
  const data = await res.json();
  document.getElementById("result").innerHTML =
    `予約完了！受付番号: <b>${data.number}</b><br>
     キャンセルする場合は <button onclick="cancel(${data.number})">ここをクリック</button>`;
  loadCount();
}

async function cancel(number) {
  if (!confirm("キャンセルしてよろしいですか？")) return;
  await fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({ action: "cancel", number: number })
  });
  alert("キャンセルしました");
  document.getElementById("result").innerHTML = "";
  loadCount();
}

loadCount();
setInterval(loadCount, 5000);
</script>
</body>
</html>
